# ==============================================================================
# ZeroPay Backend - Environment Variables
# ==============================================================================
#
# SECURITY WARNING:
# - Never commit .env file to git (already in .gitignore)
# - Use strong, randomly generated passwords (64+ characters)
# - Rotate keys every 90 days
# - In production, use HashiCorp Vault or AWS Secrets Manager
#
# ==============================================================================

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================

# Node environment (development, staging, production)
NODE_ENV=development

# Server port
PORT=3000

# API version
API_VERSION=2.0.0

# ==============================================================================
# REDIS CONNECTION
# ==============================================================================

# Redis host (use localhost for local, private IP for production)
REDIS_HOST=localhost

# Redis port (TLS enabled)
REDIS_PORT=6380

# Redis username (defined in users.acl)
REDIS_USERNAME=zeropay-backend

# Redis password (MUST match requirepass in redis.conf)
# Generate with: openssl rand -base64 48
# REQUIRED: 64 characters minimum
REDIS_PASSWORD=REPLACE_WITH_GENERATED_PASSWORD

# Redis database number (0-15)
REDIS_DB=0

# ==============================================================================
# ENCRYPTION
# ==============================================================================

# AES-256-GCM encryption key (32 bytes = 64 hex characters)
# Generate with: openssl rand -hex 32
# CRITICAL: This key encrypts all data at rest
# NEVER share or commit this key
ENCRYPTION_KEY=REPLACE_WITH_GENERATED_KEY

# Encryption algorithm (DO NOT CHANGE)
ENCRYPTION_ALGORITHM=aes-256-gcm

# ==============================================================================
# RATE LIMITING
# ==============================================================================

# General rate limit (requests per window per IP)
RATE_LIMIT_MAX=100

# Rate limit window in minutes
RATE_LIMIT_WINDOW_MINUTES=15

# Per-user enrollment rate limit (enrollments per hour)
PER_USER_RATE_LIMIT_MAX=3

# ==============================================================================
# DATA RETENTION
# ==============================================================================

# Default TTL for enrollment data (seconds)
# 24 hours = 86400 seconds
ENROLLMENT_TTL_SECONDS=86400

# Nonce validity (seconds)
NONCE_TTL_SECONDS=60

# ==============================================================================
# CORS CONFIGURATION
# ==============================================================================

# Allowed origins (comma-separated for multiple origins)
# Development: http://localhost:3000,http://localhost:8080
# Production: https://app.zeropay.com,https://merchant.zeropay.com
CORS_ORIGIN=http://localhost:3000,http://localhost:8080

# CORS credentials (true/false)
CORS_CREDENTIALS=true

# ==============================================================================
# LOGGING
# ==============================================================================

# Log level (error, warn, info, debug)
LOG_LEVEL=info

# Log format (json, simple)
LOG_FORMAT=json

# Log file path (relative to backend directory)
LOG_FILE=logs/zeropay.log

# Log errors separately
ERROR_LOG_FILE=logs/error.log

# ==============================================================================
# SECURITY HEADERS
# ==============================================================================

# HSTS max age (seconds) - 1 year = 31536000
HSTS_MAX_AGE=31536000

# Content Security Policy (CSP)
CSP_DEFAULT_SRC='self'

# ==============================================================================
# MONITORING & ALERTING
# ==============================================================================

# Enable metrics endpoint (/metrics)
ENABLE_METRICS=true

# Sentry DSN (error tracking)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project

# ==============================================================================
# DATABASE (PostgreSQL)
# ==============================================================================

# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://zeropay_app:CHANGE_ME_IN_PRODUCTION@localhost:5432/zeropay

# Connection pool settings
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_POOL_IDLE_TIMEOUT=30000

# SSL mode (disable, allow, prefer, require, verify-ca, verify-full)
DATABASE_SSL_MODE=prefer

# ==============================================================================
# VAULT/KMS INTEGRATION (Production)
# ==============================================================================

# HashiCorp Vault URL
# VAULT_URL=https://vault.zeropay.com

# Vault token or role
# VAULT_TOKEN=your-vault-token

# AWS KMS Key ID (if using AWS)
AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789012:key/your-kms-key-id
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-access-key-id
AWS_SECRET_ACCESS_KEY=your-secret-access-key

# ==============================================================================
# BLOCKCHAIN (Solana)
# ==============================================================================

# Solana RPC endpoints
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
SOLANA_DEVNET_RPC_URL=https://api.devnet.solana.com
SOLANA_TESTNET_RPC_URL=https://api.testnet.solana.com

# Blockchain network (mainnet, devnet, testnet)
BLOCKCHAIN_NETWORK=devnet

# RPC timeout (milliseconds)
SOLANA_RPC_TIMEOUT=30000

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================

# Enable nonce tracking (replay protection)
ENABLE_NONCE_TRACKING=true

# Enable per-user rate limiting
ENABLE_PER_USER_RATE_LIMIT=true

# Enable audit logging
ENABLE_AUDIT_LOG=true

# Enable structured logging (Winston)
ENABLE_STRUCTURED_LOGGING=true

# ==============================================================================
# DEVELOPMENT OPTIONS
# ==============================================================================

# Enable debug logs
DEBUG=zeropay:*

# Disable security features for testing (NEVER in production)
# DISABLE_TLS_VERIFICATION=false
# DISABLE_RATE_LIMITING=false

# ==============================================================================
# GDPR COMPLIANCE
# ==============================================================================

# Data retention policy (days)
DATA_RETENTION_DAYS=1

# Enable right to erasure endpoint
ENABLE_RIGHT_TO_ERASURE=true

# Audit log retention (days)
AUDIT_LOG_RETENTION_DAYS=90

# ==============================================================================
# END OF CONFIGURATION
# ==============================================================================

# Instructions:
# 1. Copy this file to .env
# 2. Generate secure values:
#    - REDIS_PASSWORD: openssl rand -base64 48
#    - ENCRYPTION_KEY: openssl rand -hex 32
# 3. Update redis.conf requirepass with REDIS_PASSWORD
# 4. Update redis/users.acl with passwords
# 5. Never commit .env to git!
